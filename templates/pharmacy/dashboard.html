{% extends "base/base.html" %} {% block title %}Pharmacy Dashboard |
ClinicSetu{% endblock %} {% block content %}
<h4 class="mb-3">Pharmacy Dashboard</h4>

<div class="card shadow-sm">
  <div class="card-body">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Patient</th>
          <th>Doctor</th>
          <th>Completed At</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="queueBody">
        <tr>
          <td colspan="4" class="text-muted">Loading...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}


{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  fetch("/api/v1/pharmacy/queue/")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("queueBody");

      if (!tbody) {
        console.error("queueBody not found in DOM");
        return;
      }

      tbody.innerHTML = "";

      if (!data.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="text-center text-muted">
              No pending prescriptions
            </td>
          </tr>`;
        return;
      }

      data.forEach(row => {
        tbody.innerHTML += `
          <tr>
            <td>${row.patient_name}</td>
            <td>${row.doctor_name}</td>
            <td>${new Date(row.completed_at).toLocaleString()}</td>
            <td>
              <a href="/pharmacy/prescription/${row.prescription_id}/"
                 class="btn btn-sm btn-primary">
                Open
              </a>
            </td>
          </tr>
        `;
      });
    })
    .catch(err => {
      console.error("Pharmacy queue error", err);
    });
});
</script>
{% endblock %}
