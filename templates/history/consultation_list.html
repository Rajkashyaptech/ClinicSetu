{% extends "base/base.html" %}

{% block title %}Consultation History | ClinicSetu{% endblock %}

{% block content %}
<h4 class="mb-3">Consultation History</h4>

{% if visits %}
  {% for visit in visits %}
    <div class="card mb-3">
      <div class="card-body">

        <h6>
          {{ visit.patient.full_name }}
          <small class="text-muted">
            ({{ visit.created_at|date:"d M Y" }})
          </small>
        </h6>

        <p class="text-muted mb-2">
          Doctor: {{ visit.doctor.username }}
        </p>

        <ul class="list-group">
          {% for session in visit.sessions.all %}
            {% if session.completed_at %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                  Session #{{ session.session_number }}
                  â€” {{ session.completed_at|date:"d M Y H:i" }}
                </span>

                <a href="{% url 'consultation_pdf' visit.id %}"
                   class="btn btn-sm btn-outline-primary"
                   target="_blank">
                  PDF
                </a>
              </li>
            {% endif %}
          {% endfor %}
        </ul>

      </div>
    </div>
  {% endfor %}
{% else %}
  <p class="text-muted">No consultations found.</p>
{% endif %}
{% endblock %}
